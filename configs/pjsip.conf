; =============================================================================
; PJSIP Configuration for Asterisk Telephony Service
; =============================================================================
; This configuration handles SIP trunking and NAT traversal for Oracle Cloud VM
;
; Public IP: 140.245.29.28
; =============================================================================

; -----------------------------------------------------------------------------
; TRANSPORT CONFIGURATION
; -----------------------------------------------------------------------------
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060

; NAT Configuration for Oracle Cloud VM
external_media_address=140.245.29.28
external_signaling_address=140.245.29.28
local_net=10.0.0.0/8
local_net=172.16.0.0/12
local_net=192.168.0.0/16

; -----------------------------------------------------------------------------
; SIP TRUNK PROVIDER CONFIGURATION
; Replace with your actual SIP trunk provider credentials
; -----------------------------------------------------------------------------

; --- Registration to Provider ---
[sip-trunk-provider]
type=registration
transport=transport-udp
outbound_auth=sip-trunk-auth
server_uri=sip:YOUR_PROVIDER_SERVER
client_uri=sip:YOUR_USERNAME@YOUR_PROVIDER_SERVER
retry_interval=60
expiration=3600

; --- Authentication ---
[sip-trunk-auth]
type=auth
auth_type=userpass
username=YOUR_USERNAME
password=YOUR_PASSWORD

; --- AOR (Address of Record) ---
[sip-trunk-aor]
type=aor
contact=sip:YOUR_PROVIDER_SERVER
qualify_frequency=60

; --- Endpoint (Incoming/Outgoing calls) ---
[sip-trunk-endpoint]
type=endpoint
transport=transport-udp
context=from-sip-provider
disallow=all
allow=ulaw
allow=alaw
allow=gsm
outbound_auth=sip-trunk-auth
aors=sip-trunk-aor
direct_media=no
force_rport=yes
rewrite_contact=yes
rtp_symmetric=yes

; --- Identify incoming calls from provider ---
[sip-trunk-identify]
type=identify
endpoint=sip-trunk-endpoint
match=YOUR_PROVIDER_IP

; -----------------------------------------------------------------------------
; INTERNAL EXTENSION TEMPLATE (Optional - for testing)
; -----------------------------------------------------------------------------
[endpoint-template](!)
type=endpoint
transport=transport-udp
context=internal
disallow=all
allow=ulaw
allow=alaw
direct_media=no
rtp_symmetric=yes

[test-extension]
type=endpoint
transport=transport-udp
context=internal
auth=test-auth
aors=test-aor
disallow=all
allow=ulaw
allow=alaw

[test-auth]
type=auth
auth_type=userpass
username=test
password=test123

[test-aor]
type=aor
max_contacts=5
