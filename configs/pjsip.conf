; =============================================================================
; PJSIP Configuration for Asterisk Telephony Service
; =============================================================================
; This configuration handles SIP trunking and NAT traversal for Oracle Cloud VM
;
; Public IP: 140.245.29.28
; =============================================================================

; -----------------------------------------------------------------------------
; TRANSPORT CONFIGURATION
; -----------------------------------------------------------------------------
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060

; NAT Configuration for Oracle Cloud VM
external_media_address=140.245.29.28
external_signaling_address=140.245.29.28
local_net=10.0.0.0/8
local_net=172.16.0.0/12
local_net=192.168.0.0/16

; -----------------------------------------------------------------------------
; SIP TRUNK PROVIDER CONFIGURATION
; Replace with your actual SIP trunk provider credentials
; -----------------------------------------------------------------------------

; --- Twilio SIP Trunk Configuration ---
; Twilio Elastic SIP Trunking does NOT use SIP REGISTER
; Auth happens during INVITE via Credential List (username/password)
; For outbound: Asterisk sends INVITE to Twilio with credentials
; For inbound: Twilio sends INVITE from their IP ranges (matched by identify section)
; SIP URI: asterisk-pbx.sip.us1.twilio.com

; NOTE: No registration section needed for Twilio

; --- Authentication for Twilio ---
[twilio-auth]
type=auth
auth_type=userpass
username=Asterisk
password=Asterisk@n8n-server123

; --- AOR (Address of Record) for Twilio PSTN Termination ---
[twilio-aor]
type=aor
contact=sip:asterisk-pbx1.pstn.twilio.com
qualify_frequency=60

; --- Endpoint for Twilio (Incoming/Outgoing calls) ---
[twilio-endpoint]
type=endpoint
transport=transport-udp
context=from-sip-provider
disallow=all
allow=ulaw
allow=alaw
allow=g722
outbound_auth=twilio-auth
aors=twilio-aor
direct_media=no
force_rport=yes
rewrite_contact=yes
rtp_symmetric=yes
from_user=+17756187988
from_domain=asterisk-pbx1.pstn.twilio.com
callerid="Asterisk PBX" <+17756187988>

; --- Identify incoming calls from Twilio ---
; Twilio SIP signaling IP ranges
[twilio-identify]
type=identify
endpoint=twilio-endpoint
match=54.172.60.0/30
match=54.244.51.0/30
match=54.171.127.192/30
match=35.156.191.128/30
match=54.65.63.192/30
match=54.169.127.128/30
match=54.252.254.64/30
match=177.71.206.192/30

; -----------------------------------------------------------------------------
; INTERNAL EXTENSION TEMPLATE (Optional - for testing)
; -----------------------------------------------------------------------------
[endpoint-template](!)
type=endpoint
transport=transport-udp
context=internal
disallow=all
allow=ulaw
allow=alaw
direct_media=no
rtp_symmetric=yes

[test-extension]
type=endpoint
transport=transport-udp
context=internal
auth=test-auth
aors=test-aor
disallow=all
allow=ulaw
allow=alaw

[test-auth]
type=auth
auth_type=userpass
username=test
password=test123

[test-aor]
type=aor
max_contacts=5
